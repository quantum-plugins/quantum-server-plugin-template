name: Build, Test and publish

on:
    push:
        branches:
            - '*'

jobs:
    tox:
        name: Run Tox python-${{ matrix.version }}
        runs-on: ${{ matrix.os }}
        strategy:
            fail-fast: false
            matrix:
                version:
                    - '3.12'
                    - '3.11'
                    - '3.10'
                    - '3.7.9'
                os:
                    - ubuntu-latest

        permissions:
            contents: read

        steps:
            - uses: actions/checkout@v4

            - uses: actions/setup-python@v5
              with:
                  python-version: ${{ matrix.version }}

            - name: install dependencies
              run: |
                  pip install -r requirements.txt -r dev-requirements.txt

            - name: Run tox checks
              if: ${{ github.ref  == 'main' }}
              run: tox
